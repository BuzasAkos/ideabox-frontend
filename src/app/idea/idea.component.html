<div class="tabs-container">
    @for (tab of tabs; track $index) {
        <span
            [class.tab-highlight]="tabState === $index"
            (click)="changeTab($index)">
            {{ tabs[$index] }}
        </span>
    }
</div>

<div class="action-buttons">
    <button 
        class="primary-button"
        (click)="onPostClicked()">
        Post a new idea
    </button>
</div>

<div class="idea-list">
    @for (idea of ideas; track $index) {
        <div class="list-item">
            <div class="idea-user">
                <strong> {{ idea.createdBy }} </strong> posted on 
                {{ idea.createdAt | date : "dd MMM, HH:mm"  }}:
            </div>
            <div class="idea-title">
                {{ idea.title }}
            </div>
            <div class="idea-desc">
                {{ idea.description }}
            </div>
            <div class="idea-footer">
                <span
                    class="details-button"
                    (click)="onDetailsClicked(idea)">
                    {{ idea.voteCount }} {{ idea.voteCount > 1 ? 'votes' : 'vote' }}
                </span>
                <span
                    class="details-button"
                    (click)="onDetailsClicked(idea)">
                    {{ idea.comments.length }} {{ idea.comments.length > 1 ? 'comments' : 'comment' }}
                </span>
            </div>
            <div class="idea-buttons">
                <button class="idea-button" 
                    *ngIf="!votedFor(idea)"
                    (click)="vote(idea._id)">
                    Vote
                </button>
                <button class="idea-button button-highlight" 
                    *ngIf="votedFor(idea)"
                    (click)="unvote(idea._id)">
                    Unvote
                </button>
                <button class="idea-button"
                    (click)="onDetailsClicked(idea)">
                    Comment
                </button>
                <img 
                    *ngIf="idea.createdBy === ideaSignalService.user()"
                    src="../../assets/edit-icon.svg" 
                    alt="Edit idea" 
                    height="30"
                    class="action-icon"
                    (click)="onEditClicked(idea)"
                >
                <img 
                    *ngIf="idea.createdBy === ideaSignalService.user()"
                    src="../../assets/remove-icon.svg" 
                    alt="Remove idea" 
                    height="30"
                    class="action-icon"
                    (click)="onRemoveClicked(idea)"
                >
            </div>
        </div>
    }
</div>

@if (popupState) {
    <div class="popup-container">
      <div class="popup-window">
          @if (popupState === 1) {
            <div class="popup-title">
                Post a new idea:
            </div>
            <form [formGroup]="newIdeaForm" (ngSubmit)="onSaveNewIdea()">
              <div class="form-items">
                <label for="title" class="form-label">
                    Title:
                </label>
                <input 
                    type="text" 
                    class="form-input"
                    formControlName="title"
                    id="ideaTitle">
                <label for="title" class="form-label">
                    Description:
                </label>
                <textarea 
                    type="text" 
                    class="form-input"
                    formControlName="description"
                    id="ideaDescription">
                </textarea>
                </div>
                <div class="action-buttons">
                    <button 
                        class="primary-button"
                        type="submit"
                        [disabled]="newIdeaForm.invalid">
                        Save
                    </button>
                    <button 
                        class="secondary-button"
                        type="button"
                        (click)="onCancelClicked()">
                        Cancel
                    </button>
                </div>
            </form>
          }

          @if (popupState === 2) {
            <div class="popup-title">
                Edit your idea:
            </div>
            <form [formGroup]="newIdeaForm" (ngSubmit)="onSaveEditedIdea()">
              <div class="form-items">
                <label for="title" class="form-label">
                    Title:
                </label>
                <input 
                    type="text" 
                    class="form-input"
                    formControlName="title"
                    id="ideaTitle">
                <label for="title" class="form-label">
                    Description:
                </label>
                <textarea 
                    type="text" 
                    class="form-input"
                    formControlName="description"
                    id="ideaDescription">
                </textarea>
                </div>
                <div class="action-buttons">
                    <button 
                        class="primary-button"
                        type="submit"
                        [disabled]="newIdeaForm.invalid">
                        Save
                    </button>
                    <button 
                        class="secondary-button"
                        type="button"
                        (click)="onCancelClicked()">
                        Cancel
                    </button>
                </div>
            </form>
          }

          @if (popupState === 3) {
            <div class="popup-title">
                Remove your idea:
            </div>
            <div class="popup-message">
                Do you really want to remove this idea?
            </div>
            <div class="popup-message">
                <strong> {{ selectedIdea?.title }} </strong>
            </div> 
            <div class="action-buttons">
                <button 
                    class="primary-button"
                    type="button"
                    (click)="removeIdea()">
                    Remove
                </button>
                <button 
                    class="secondary-button"
                    type="button"
                    (click)="onCancelClicked()">
                    Cancel
                </button>
            </div>
          }

          @if (popupState === 4) {
            <div class="popup-title">
                Details:
            </div>
            <div class="list-item" *ngIf="selectedIdea">
                <div class="idea-user">
                    {{ selectedIdea.createdBy }} posted on 
                    {{ selectedIdea.createdAt | date : "dd MMM, hh:mm"  }}:
                </div>
                <div class="idea-title">
                    {{ selectedIdea.title }}
                </div>
                <div class="idea-desc">
                    {{ selectedIdea.description }}
                </div>
                <div class="comments-container">
                    <div class="comments-title">
                        Comments:
                    </div>
                    <form [formGroup]="commentForm" (ngSubmit)="onSendComment()">
                      <div class="comment-input-row">
                        <input 
                            type="text" 
                            class="comment-input"
                            formControlName="text"
                            placeholder="Add your comment">
                        <img src="../../assets/send-icon.svg" height="24" alt="Send" 
                            class="comment-send"
                            *ngIf="commentForm.valid"
                            (click)="onSendComment()">
                      </div>
                    </form>
                    @for (comment of selectedIdea.comments.reverse(); track $index) {
                        <div class="comment-header">
                            {{ comment.createdBy }} wrote on {{ comment.createdAt | date : "dd MMM, hh:mm" }}:
                        </div>
                        <div class="comment-text">
                            {{ comment.text }}
                        </div>
                    }
                </div>
            </div>
            <div class="vote-details">
                {{ selectedIdea?.voteCount }} vote(s)
                <span *ngIf="(selectedIdea?.voteCount || 0) > 0">
                    by @for (vote of selectedIdea?.votes; track $index) {
                        {{ vote.createdBy }}
                    }
                </span>
            </div>
            <div class="action-buttons">
                <button 
                    class="secondary-button"
                    type="button"
                    (click)="onCancelClicked()">
                    Close
                </button>
            </div>
          }
      </div>
    </div>
}
